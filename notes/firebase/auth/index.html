---
layout: slides
title: Firebase Authentication
week: 3
---


<div class="slide">
	<h2>Client side authentication</h2>
	<p>Firebase can handle authentication on the client side, which relieves us from a lot of work implementing authentication on the back end.</p>
</div>

<div class="slide">
	<p>In the Firebase console, let's set up some authentication.</p>
	<p>Click on the Authentication item under Develop.</p>
	<img src="authentication.png" alt="">
	<p>This is where we will manage users of our application.</p>
</div>

<div class="slide">
	<h2>Users</h2>
	<p>This interface allows us to create multiple types of authentication and manage users.</p>
	<img src="setup_signin.png" alt="">
</div>

<div class="slide">
	<p>We can also set the domains that will be allowed to interact with our app.</p>
	<img src="domains.png" alt="">
	<p>The defaults should be fine here.  <code>localhost</code> is where we are developing the app and the Firebase URL is where we will eventually push the app.</p>
</div>

<div class="slide">
	<p>We're going to start by adding email provider.  This is a simple authentication method.  We will ignore the other methods but feel free to try adding them if you like.</p>
	<img src="provider.png" alt="">
</div>

<div class="slide">
	<img src="provider_email.png" alt="">
</div>

<div class="slide">
	<h2>Create user</h2>
	<p>We need some text inputs and a button for the user to submit their info.  We're not using a <code>&lt;form&gt;</code> here because this is all client side.</p>
	<div class="ex" data-lang="html">&lt;div id="auth"&gt;
	&lt;input type="text" id="username" placeholder="Username"&gt;
	&lt;input type="text" id="email" placeholder="Email"&gt;
	&lt;input type="password" id="password" placeholder="Password"&gt;
	&lt;button id="sign-up"&gt;Sign Up&lt;/button&gt;
	&lt;button id="login"&gt;Log In&lt;/button&gt;
&lt;/div&gt;</div>
</div>

<div class="slide">
	<p>When the user click the button, we need to capture their name, email and password and create a new user.</p>
	<p>We'll start with a simple sign up and then work on creating the user.</p>
	<p>First we need to create a new file in the <code>js/</code> folder to handle authentication.  Let's call in <code>auth.js</code>.</p>
	<p>We need to attach it to the <code>index.html</code> file with a script tag.</p>
	<pre><code>&lt;script src="js/auth.js"&gt;&lt;/script&gt;</code></pre>
</div>

<div class="slide">
	<p>Like our previous <code>data.js</code> file we need to create an event to make sure the window is loaded before trying to do any authentication.</p>
	<div class="ex">window.addEventListener('load', function() {
	// auth code goes here
});</div>
</div>

<div class="slide">
	<p>Then get references to our HTML inputs and buttons so we can create events and get the user input in each field.</p>
	<div class="ex">const userNameAuth = document.getElementById('name');
const emailAuth = document.getElementById('email');
const passwordAuth = document.getElementById('password');
const signUpBtn = document.getElementById('sign-up');
const logInBtn = document.getElementById('log-in');
const logOutBtn = document.getElementById('log-out');</div>
</div>

<div class="slide">
	<p>To create a user, add an event to the sign up button and then get the email and password and use Firebases's <code>createUserWithEmailAndPassword</code> method.</p>
	<div class="ex">signUpBtn.addEventListener('click', function() {
	const email = emailAuth.value;
	const password = passwordAuth.value;
	const auth = firebase.auth();
	auth.createUserWithEmailAndPassword(email, password);
});</div>
</div>

<div class="slide">
	<p>That will add a user to the authentication table.  Give that a try and then refresh the authentication table in the Firebase console to see if a user is added.</p>
	<p>Once that works, there's some more work we need to to create the user in the database.</p>
	<p>We're going to modify the above code, starting by creating a <code>Promise</code> from the result of the <code>createUserWithEmailAndPassword</code> method.</p>
	<div class="ex">const createUserPromise = auth.createUserWithEmailAndPassword(email, password);</div>
</div>

<div class="slide">
	<p>In JavaScript, a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="blank">Promise</a> represents the eventual outcome of a asynchronous function.  This could be either the completion of the function or a failure.  Using a Promise allows the developer to wait for either outcome and then write code to behave according to that outcome.</p>
	<p>When creating a new user, either the user will be created, or we will receive some kind of error.  If a user is created, we will want to store that user in the database.</p>
	<p>The <code>createUserPromise</code> will return a user credential with some information we can use to store that user in our database.</p>
</div>

<div class="slide">
	<p><code>.then</code> fires when the function completes.</p>
	<div class="ex">createUserPromise.then(function(credential) {
	const id = credential.user.id;
	const db = firebase.database();
	const ref = db.ref('users').child(id);
	const userInfo = {
		displayName: userNameAuth.value
	};
	ref.set(userInfo);
	credential.user.updateProfile(userInfo);
});</div>
</div>

<div class="slide">
	<p><code>ref.set</code> and <code>credential.user.updateProfile</code> also return promises.  If there's something that needs to be updated those could be assigned to new promise objects.</p>
	<p>This code will add a new user with a user display name.  Check the Firebase console database to see the updated user.</p>
</div>

<div class="slide">
	<p><code>.catch</code> will return an error.  If there is an error we can display it to the user.</p>
	<p>For now, an alert will do, but in the future we could build this into the HTML page.</p>
	<div class="ex">createUserPromise.catch(function(error) {
	alert(error.message);
});</div>
</div>

<div class="slide">
	<h2>Log out</h2>
	<p>Now that we have a user, that user will be logged in, so let's add a function to let them log out.</p>
	<div class="ex">logOutBtn.addEventListener('click', function() {
	firebase.auth().signOut();
});</div>
</div>

<div class="slide">
	<h2>Log in</h2>
	<p>So once a user logs out, they need to log in.</p>
	<div class="ex">logInButton.addEventListener('click', function() {
	const email = document.getElementById('email').value;
	const password = document.getElementById('password').value;
	firebase.auth().signInWithEmailAndPassword(email, password);
});</div>
</div>

<div class="slide">
	<h2>User name</h2>
	<p>Now that we have a user, let's display the user name.  We can also throw the log out button in here.</p>
	<div class="ex" data-lang="html">&lt;div id="user-info" style="display:none"&gt;
	&lt;span id="display-name"&gt;&lt;/span&gt;
	&lt;button id="log-out"&gt;Log Out&lt;/button&gt;
&lt;/div&gt;</div>
	<p>Then let's make a function to display the user name.  This function can also hide the log in div.</p>
</div>

<div class="slide">
	<div class="ex">function displayUserInfo() {
	document.getElementById('display-name').textContent = "Hi " + firebase.auth().currentUser.displayName;
	document.getElementById('user-info').style.display = 'block';
	document.getElementById('auth').style.display = 'none';
}</div>
</div>

<div class="slide">
	<p>We can call this function from the promise returned when we sign in.</p>
	<div class="ex">const signInPromise = auth.signInWithEmailAndPassword(email, password);
signInPromise.then(displayUserInfo);</div>
</div>

<div class="slide">
	<p>Then we have to go back and modify log out to do the opposite.</p>
	<div class="ex">logOutBtn.addEventListener('click', function() {
	firebase.auth().signOut();
	document.getElementById('auth').style.display = 'block';
	document.getElementById('user-info').style.display = 'none';
});</div>
</div>

<div class="slide">
	<h2>Auth state</h2>
	<p>To keep users logged in, Firebase stores a user key in the local storage in the browser.  This means if you refresh the page, or close your browser and return later, you will still be logged in.</p>  
	<p>In order to detect this we can use another Firebase Authentication function.</p>
	<div class="ex">firebase.auth().onAuthStateChanged(function(user) {
	if (user) {
		displayUserInfo();
	}
});</div>
</div>

<div class="slide">
	<h2>Done!</h2>
	<p>Okay, that was a lot of work, but now we can login in our users.</p>
	<p>By verifying users, we can use there user ID to set up a database that stores information specific to each user, and restrict access to different parts of the site based on authentication.</p>
</div>